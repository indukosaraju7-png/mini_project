import{a as c}from"./stimulus-helpers-Bg5ApOVk-1.js";import u from"./ez-base-controller-DuL8VR07-1.js";import{E as r}from"./ez-custom-events-B9oXrnTo-1.js";import{t as d}from"./helpers-DWGVlOV6-1.js";import{R as h}from"./rails-ujs-DLwK8N9E-1.js";import"./stimulus-Cq41p_up-1.js";import"./js-Cz0CWeBA-1.js";import"./init-user-CLXATX98-1.js";const o=class o extends u{constructor(){super(...arguments),this.wrapperToggleClasses=["ez-form-select-field__current"],this.blurSubMenus=e=>{const t=document.querySelectorAll(".ez-form-select-field.is-open"),i=e.target.closest(".ez-form-select-field");t&&t.forEach(s=>{i!==s&&d(r,{},s)})},this.navigateSelect=e=>{var t,i;if(this.element.classList.contains("is-open")){if(!this.focusedOption){const s=this.valueFieldTarget.value;this.setFocusedOption(this.element.querySelector(`.ez-form-select-field__item[data-ez-form-select-value-param="${s}"]`)||this.element.querySelector(".ez-form-select-field__item:first-of-type"));return}e.key==="ArrowDown"?(e.stopPropagation(),e.preventDefault(),this.setFocusedOption((t=this.focusedOption)==null?void 0:t.nextSibling)):e.key==="ArrowUp"?(e.stopPropagation(),e.preventDefault(),this.setFocusedOption((i=this.focusedOption)==null?void 0:i.previousSibling)):e.key==="Enter"&&(this.focusedOption.click(),this.closeDropDown())}},this.setSelected=e=>{const{value:t}=e.params,i=e.target.textContent;if(this.isMultiSelect()){const s=this.valueFieldTarget;for(;s.options.length;)s.remove(0);this.isMultiChecked(e.target)?this.selectedValue=this.selectedValue.filter(l=>l.value!==t):this.selectedValue=this.selectedValue.concat({text:i,value:t}),this.selectedValue.length>0&&this.selectedValue.forEach(l=>{const n=document.createElement("option");n.text=l.text,n.value=l.value,n.setAttribute("selected","true"),s.add(n)})}else this.valueFieldTarget.value=t==="all"?"":t;this.valueFieldTarget.dispatchEvent(new Event("change")),this.selectSubmitValue&&this.submitForm()},this.handleSelectOptionClick=e=>{this.setSelected(e),this.isMultiSelect()&&(this.isMultiChecked(e.target)?e.target.classList.remove("is-checked"):e.target.classList.add("is-checked")),this.hasInputFieldTarget?this.isMultiSelect()?this.inputFieldTarget.value=this.multiSelectLabel():(this.inputFieldTarget.value=e.target.textContent,this.inputFieldTarget.dispatchEvent(new Event("input"))):this.currentLabelTarget.textContent=e.target.textContent,this.toggleDropDown(this.element)},this.closeDropDown=()=>{this.element.classList.remove("is-open"),document.removeEventListener("keydown",this.navigateSelect)},this.handleKeyUp=e=>{e.key==="Escape"&&this.blurSubMenus(e)},this.handleKeyDown=e=>{this.element.classList.contains("is-open")&&e.key==="Tab"&&(this.focusedOption?this.focusedOption.click():this.closeDropDown())}}connect(){this.isMultiSelect()&&(this.selectedValue=[]),this.element.addEventListener(r,this.closeDropDown),window.addEventListener("keyup",this.handleKeyUp),window.addEventListener("keydown",this.handleKeyDown),document.addEventListener("click",this.blurSubMenus)}disconnect(){this.element.removeEventListener(r,this.closeDropDown),window.removeEventListener("keyup",this.handleKeyUp),window.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("click",this.blurSubMenus)}handleSelectClick(e){this.blurSubMenus(e),this.toggleDropDown(this.element),document.addEventListener("keydown",this.navigateSelect),this.element.focus()}setFocusedOption(e){if(!(e&&e instanceof HTMLElement))return;requestAnimationFrame(()=>{var s;(s=this.focusedOption)==null||s.classList.remove("is-focused"),this.focusedOption=e,e.classList.add("is-focused")});const{scrollX:t,scrollY:i}=window;e.scrollIntoView({container:"nearest",block:"end"}),window.scrollTo(t,i)}submitForm(){const e=this.element.closest("form");e.getAttribute("data-remote")==="true"?h.fire(e,"submit"):e.submit()}toggleDropDown(e){e.classList.toggle("is-open"),e.classList.contains("is-open")||document.removeEventListener("keydown",this.navigateSelect)}isMultiSelect(){return this.element.classList.contains("ez-form-select-field--multi")}isMultiChecked(e){return e.classList.contains("is-checked")}multiExistingValue(e){return e&&typeof e<"u"&&JSON.parse(e)instanceof Array?JSON.parse(e):[]}multiSelectLabel(){return this.selectedValue.map(e=>e.text).join(", ")}};o.targets=["currentLabel","valueField","inputField"],o.values={selectSubmit:Boolean};let a=o;c({name:"ez-form-select",import:a});export{a as default};

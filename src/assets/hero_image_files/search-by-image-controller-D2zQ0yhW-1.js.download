import{_ as m}from"./preload-helper-cYIQMxwj-1.js";import{a as h}from"./stimulus-helpers-Bg5ApOVk-1.js";import g from"./ez-base-controller-DuL8VR07-1.js";import{t as o}from"./helpers-DWGVlOV6-1.js";import{S as d,f as u}from"./ez-custom-events-B9oXrnTo-1.js";import{c as p}from"./ajax-helpers-BQLKOG2a-1.js";import"./stimulus-Cq41p_up-1.js";import"./js-Cz0CWeBA-1.js";import"./init-user-CLXATX98-1.js";import"./index-C4xxlH8f-1.js";import"./_commonjsHelpers-BosuxZz1-1.js";import"./modal_helpers-SODIeXFK-1.js";const c='<div class="ez-spinner ez-spinner--color-mono"></div>',s=class s extends g{constructor(){super(...arguments),this.mobileTriggerSearchByImage=()=>{this.targetTarget.click()},this.closeOnOutsideClick=e=>{this.instanceFileDialog&&!this.instanceFileDialog.contains(e.target)&&!this.instanceTarget.contains(e.target)&&!e.target.classList.contains("dz-hidden-input")&&this.hideSearchByImageForm()},this.loadSearchByImageFormError=()=>{o(d)},this.clearSearchByImageDragDrop=()=>{o(u)}}connect(){this.initSearchByImage()}disconnect(){this.searchByImageTooltipInitialized=!1,document.removeEventListener("click",this.closeOnOutsideClick)}loadSearchByImageForm(){setTimeout(()=>{var e;(e=this.instanceFileDialog)!=null&&e.querySelector(".search-by-image__choose-file__url-area")?requestAnimationFrame(()=>{var t;(t=this.instanceTarget)==null||t.classList.remove("is-loading")}):p("/search_by_image_form",t=>{requestAnimationFrame(()=>{var i;this.instanceDialogContent.innerHTML=t.data,(i=this.instanceTarget)==null||i.classList.remove("is-loading")})},()=>{requestAnimationFrame(()=>{this.loadSearchByImageFormError()})})}),this.hasTriggerParentTarget&&requestAnimationFrame(()=>{this.triggerParentTarget.classList.add("has-search-by-image-ui")}),this.hasSearchInputTarget&&(this.backupSearchPlaceholder=this.searchInputTarget.placeholder,this.searchInputTarget.placeholder=this.placeholderValue)}hideSearchByImageForm(){var e,t,i;(e=this.instanceTarget)==null||e.classList.remove("is-active"),(t=this.instanceTarget)==null||t.classList.remove("is-loading"),this.hasTriggerParentTarget&&this.triggerParentTarget.classList.remove("has-search-by-image-ui"),this.hasSearchInputTarget&&(this.searchInputTarget.placeholder=this.backupSearchPlaceholder),(i=this.instanceFileDialog)!=null&&i.querySelector(".search-by-image__choose-file__url-area")&&(this.element.removeAttribute("data-disable-form-submit"),this.clearSearchByImageDragDrop()),setTimeout(()=>{if(this.hasTriggerParentTarget){const r=this.triggerParentTarget.querySelector('[data-search-form-target="submit"]');r&&r.classList.remove("is-loading")}})}toggleFileDialog(e){"anchorName"in document.documentElement.style&&(this.instanceTarget=e.currentTarget,this.instanceTarget.classList.contains("is-active")?requestAnimationFrame(()=>{this.hideSearchByImageForm(),document.removeEventListener("click",this.closeOnOutsideClick)}):(this.element.setAttribute("data-disable-form-submit","true"),document.addEventListener("click",this.closeOnOutsideClick),this.insertDialogElements(),this.instanceDialogContent=this.instanceFileDialog.querySelector(".search-by-image__content"),requestAnimationFrame(()=>{this.instanceTarget.classList.add("is-active"),requestAnimationFrame(()=>{this.loadSearchByImageForm()})})))}insertDialogElements(){document.body.querySelector(".search-by-image__dialog")||(this.instanceFileDialog=document.createElement("div"),this.instanceFileDialog.classList.add("search-by-image__dialog"),this.instanceFileDialog.innerHTML=`
      <div class="search-by-image__content">${c}</div>`,this.instanceTarget.parentElement.appendChild(this.instanceFileDialog))}initSearchByImage(){if(!this.searchByImageTooltipInitialized){const e=this,t=this.hasTriggerParentTarget?this.triggerParentTarget:"parent";if("anchorName"in document.documentElement.style)return;m(()=>import("./tippy-CMjLIZZA-1.js"),[],import.meta.url).then(i=>{const r=i.default;r(this.targetTargets,{content:c,allowHTML:!0,animation:"rising",interactive:!0,appendTo:t,placement:"bottom-end",theme:"search-by-image",delay:[0,null],duration:0,maxWidth:"none",offset:[0,10],trigger:"click",popperOptions:{modifiers:[{name:"flip",enabled:!1}]},onCreate(a){a.popper.classList.add("search-by-image-tooltip"),e.instanceDialogContent=a.popper.querySelector(".tippy-content")},onTrigger(a,l){e.element.setAttribute("data-disable-form-submit","true"),e.instanceTarget=l.currentTarget,requestAnimationFrame(()=>{e.instanceTarget.classList.add("is-active")})},onShow(a){e.instanceFileDialog=a.popper,requestAnimationFrame(()=>{e.loadSearchByImageForm()})},onHide(a){e.instanceFileDialog=a.popper,requestAnimationFrame(()=>{e.hideSearchByImageForm()})}}),e.searchByImageTooltipInitialized=!0})}}};s.targets=["searchInput","triggerParent","target"],s.values={verticalOffset:Number,placeholder:String};let n=s;h({name:"search-by-image",import:n});export{n as default};

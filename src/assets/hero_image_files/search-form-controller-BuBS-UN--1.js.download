import{a as w}from"./stimulus-helpers-Bg5ApOVk-1.js";import{a as T}from"./js-Cz0CWeBA-1.js";import C from"./ez-base-controller-DuL8VR07-1.js";import{e as c}from"./events-BkNvg-Hc-1.js";import{E as L,c as b,t as u,F as g,G as E,d,H as v,I as F,h,a as k}from"./helpers-DWGVlOV6-1.js";import{F as I}from"./filters-state-BjbyzNKW-1.js";import{S as _}from"./scroll-position-helpers-CGL_xFnA-1.js";import{sendTrackingEvent as l,trackCompleteEvent as y}from"./tracking-ChOFcS2D-1.js";import{Q as P,U as R,V as q,W as x,X as H,Y as $,Z as z,_ as O,$ as M}from"./actions-C6z5I147-1.js";import{a as A}from"./index-C4xxlH8f-1.js";import"./stimulus-Cq41p_up-1.js";import"./init-user-CLXATX98-1.js";import"./_commonjsHelpers-BosuxZz1-1.js";const p=class p extends C{constructor(){super(...arguments),this.navigationKeyCodes=["ArrowUp","ArrowLeft","ArrowRight","ArrowDown","Enter"],this.exclusionKeyCodes=["MetaLeft","MetaRight","ControlLeft","ControlRight","AltLeft","AltRight","ShiftLeft","ShiftRight"],this.wrapperToggleClasses=["inline-filters","inline-filters__arrow","inline-filters__current"],this.scrollToSearch=()=>{if(this.isMobile()&&L()){const t=this.inputTarget.getBoundingClientRect().top+window.scrollY-20;b(t)}},this.updateSearchSwatch=e=>{const t=e.detail.color;this.searchFormColorSwatches.forEach(i=>{requestAnimationFrame(()=>{i.parentElement.classList.add("ez-search-form__searched-color--active"),i.style.backgroundColor=`#${t}`})})},this.resetColorSwatchFilter=()=>{this.searchFormColorSwatches.forEach(e=>{requestAnimationFrame(()=>{e.parentElement.classList.remove("ez-search-form__searched-color--active"),e.style.backgroundColor=""})}),u("resetColorSwatchFilter")},this.resizeInput=()=>{this.inputTarget.value?requestAnimationFrame(()=>{this.hiddenInputHolderTarget.textContent=this.inputTarget.value}):requestAnimationFrame(()=>{this.inputTarget.placeholder=this.savedPlaceholder||this.inputTarget.placeholder,this.inputTarget.setAttribute("aria-label",this.savedPlaceholder||this.inputTarget.placeholder),this.hiddenInputHolderTarget.textContent=this.inputTarget.placeholder}),g()&&this.repositionColorSwatch()},this.repositionColorSwatch=()=>{var e;(e=this.searchFormColorSwatches)==null||e.forEach(t=>{if(!t.parentElement)return;const i=this.inputTarget?this.inputTarget.offsetLeft:0;requestAnimationFrame(()=>{t.parentElement.style.left=`${(this.hiddenInputWidth||1)+i}px`,t.parentElement.classList.remove("is-hidden")})})},this.handleInputClick=()=>{this.inputTarget.value.length>=2&&this.queryAutocomplete(this.inputTarget.value)},this.removeAutoFocus=e=>{E(e)||this.element.classList.remove("is-auto-focused")},this.setTogglesFromState=()=>{const e=window.filtersState.getRawParamKeyValues();[...this.element.querySelectorAll(".ez-input--checkbox input")].forEach(i=>{const s=i.closest(".ez-input--checkbox").getAttribute("data-filter-param");e.includes(s)&&this.setActiveFilter(i)})},this.clearPreviousSearches=e=>{window.localStorage.removeItem("previous_searches"),e&&e.currentTarget&&l({element:e.currentTarget,data:{action:P}}),requestAnimationFrame(()=>{this.previousSearchesTarget.classList.add("is-hidden")})},this.handleFilterClick=e=>{this.wrapperToggleClasses.forEach(t=>{e.target.classList.contains(t)&&this.toggleInlineFilters()})},this.setActiveFilter=(e,t=!1)=>{const i=e.closest(".inline-filters__item, .content-type-tabs__tab");if(!i){console.error("Could not find a valid parent for the filter option.");return}[...this.element.querySelectorAll('input[name="content"]')].forEach(r=>{r.checked=!1}),e.checked=!0,requestAnimationFrame(()=>{if(this.hasCurrentLabelTarget)if(d()<=635){this.currentLabelTarget.innerHTML="";const r=i.querySelector("svg");r&&this.currentLabelTarget.appendChild(r.cloneNode(!0))}else i.dataset.selected&&(this.currentLabelTarget.textContent=i.dataset.selected);i.dataset.searchSelected&&(this.inputTarget.placeholder=i.dataset.searchSelected,this.inputTarget.setAttribute("aria-label",i.dataset.searchSelected)),this.hasPopularSearchesLinkTarget&&(this.popularSearchesLinkTarget.dataset.popularTypes.includes(e.value)?this.popularSearchesTarget.classList.remove("is-hidden"):this.popularSearchesTarget.classList.add("is-hidden"),this.popularSearchesLinkTarget.href=i.dataset.popularSearchPath,this.popularSearchesLinkTarget.textContent=i.dataset.popularSearchText,this.popularSearchesLinkTarget.setAttribute("data-english-label",i.dataset.englishLabel))}),t||u(c.search.update_content_type,{contentType:e.value})},this.handleFilterOptionClick=e=>{const t=e.currentTarget,i=t.getAttribute("name"),s=t.dataset.value||t.getAttribute("value");if(this.setActiveFilter(t,!0),window.filtersState.omittedFromState(i)||window.filtersState.updateParamKey(`${i}-${s}`),this.hasInlineFiltersTarget&&this.toggleInlineFilters(),document.body.classList.contains("searches-show"))v()?F("content_type",s):u(c.search.apply_filters,{contentType:s,preserveFilters:this.preserveFiltersValue});else{const r=t.closest(".inline-filters__item");this.updateContentType(s,r==null?void 0:r.dataset.autocompleteContentType),this.autoFocusSearchForm()}this.trackContentTypeSelection(t)},this.handlePopularSearchesLinkClick=e=>{this.trackPopularSearchClick(e)},this.toggleInlineFilters=()=>{requestAnimationFrame(()=>{this.inlineFiltersTarget.classList.toggle("is-open")})},this.blurInlineFilters=e=>{this.inlineFiltersTarget.classList.contains("is-open")&&!e.target.closest(".ez-search-form .inline-filters")&&this.toggleInlineFilters()},this.handleInputKeyUp=e=>{!this.exclusionKeyCodes.includes(e.code)&&!this.navigationKeyCodes.includes(e.code)&&this.checkAndToggleIsTyped(),g()&&this.searchFormColorSwatches.forEach(t=>{t.style.backgroundColor!==""&&setTimeout(()=>{t.parentElement.classList.add("ez-search-form__searched-color--active")},600)}),this.navigationKeyCodes.includes(e.code)&&document.querySelector(".ez-search-form__suggestions li")?this.navigateSuggestions(e.code):!this.exclusionKeyCodes.includes(e.code)&&this.inputTarget.value.length>=2?this.queryAutocomplete(this.inputTarget.value):this.autocompleteSuggestionsTarget.innerHTML!==""&&this.resetAutocomplete()},this.handleInputKeyDown=e=>{e.metaKey&&e.code==="Enter"&&this.submit(e)},this.handleSuggestionClick=e=>{const t=e.currentTarget,i=t.textContent;if(this.inputTarget.value=i,t.parentElement===this.autocompleteSuggestionsTarget)this.data.set("lastActiveAutocompleteTerm",i);else if(t.parentElement===this.previousSearchTermsTarget){const{contentType:s}=t.dataset;l({element:t,data:{action:O,label:`Term-${i}`,content_type:`Content-${s}`}})}this.submit(e)},this.navigateSuggestions=e=>{const t=this.autocompleteSuggestionsTarget,i=t.querySelector("li.is-active"),s=this.previousSearchTermsTarget,r=s.querySelector("li.is-active"),a=n=>{let o=this.autocompleteSuggestionsTarget.querySelector("li.is-active");o||(o=this.previousSearchTermsTarget.querySelector("li.is-active")),o&&requestAnimationFrame(()=>{o.classList.remove("is-active")}),n&&(requestAnimationFrame(()=>{n.classList.add("is-active")}),this.data.set("lastActiveAutocompleteTerm",n.textContent),this.inputTarget.value=n.textContent)},f=n=>{this.previousSearchesTarget.classList.contains("is-hidden")?a(n==="navDown"?t.querySelector("li:first-of-type"):t.querySelector("li:last-of-type")):a(s.querySelector("li:first-of-type"))};e==="ArrowUp"?(()=>{r?a(t.querySelector("li:last-of-type")):i&&i.previousSibling?a(i.previousSibling):f("navUp")})():e==="ArrowDown"?(()=>{i&&i.nextSibling?a(i.nextSibling):i&&!i.nextSibling?f("navDown"):a(t.querySelector("li:first-of-type"))})():e==="ArrowRight"?(()=>{r&&(r.nextElementSibling&&(d()<=750||r.getBoundingClientRect().top===r.nextElementSibling.getBoundingClientRect().top)?a(r.nextElementSibling):a(s.querySelector("li:first-of-type")))})():e==="ArrowLeft"?(()=>{if(r)if(r.previousElementSibling)a(r.previousElementSibling);else if(d()<=750)a(s.querySelector("li:last-of-type"));else{const n=r.getBoundingClientRect().top;let o;s.querySelectorAll("li").forEach(S=>S.getBoundingClientRect().top!==n?!1:(o=S,!0)),a(o)}})():e==="Enter"&&this.resetAutocomplete()},this.resetAutocomplete=()=>{this.data.set("lastTerm",""),requestAnimationFrame(()=>{this.autocompleteSuggestionsTarget.innerHTML="",this.formTarget.classList.remove("is-suggesting")})},this.autocompleteUrl=()=>{const e=this.inputTarget.getAttribute("data-autocomplete-content-type").replace("_","-"),t=document.documentElement.getAttribute("lang");return`${this.inputTarget.getAttribute(`data-autocomplete-source-${e}`)??this.inputTarget.dataset.autocompleteSource}${t}`},this.queryAutocomplete=async e=>{if(e===this.data.get("lastTerm"))return;this.data.set("lastTerm",this.inputTarget.value);const t=this.inputTarget.getAttribute("data-content-type"),i=this.autocompleteUrl();try{const r=(await A.get(`${i}?term=${encodeURI(e)}&content_type=${t}`,{headers:{"Content-Type":"text/plain"}})).data.slice(0,6);this.renderAutocomplete(r,e)}catch(s){console.error(s)}}}connect(){var e;window.filtersState=(e=window.filtersState)!=null&&e.isSearchState()?window.filtersState:new I,window.filtersState.addPopStateListener(),window.EezyStickyScrollPositionHelper||(window.EezyStickyScrollPositionHelper=_),this.hasInputTarget&&(this.isMobile()||this.autoFocusSearchForm(),!this.isMobile()&&window.EezyScrollPositionHelper&&window.EezyScrollPositionHelper.allowFocus()&&window.EezyScrollPositionHelper.resetScrollPosition(),g()&&(this.searchFormColorSwatches=document.querySelectorAll('[data-search-form-target="searchedColor"]'),window.addEventListener("updateEzSearchFormColorSwatch",this.updateSearchSwatch)),this.hasInlineFiltersTarget&&this.setupInlineFilters(),this.checkAndToggleIsTyped(),this.inputTarget.addEventListener("blur",this.resizeInput),this.inputTarget.addEventListener("keyup",this.resizeInput),this.inputTarget.addEventListener("keydown",this.resizeInput),this.inputTarget.addEventListener("click",this.removeAutoFocus),this.inputTarget.addEventListener("keydown",this.removeAutoFocus),window.addEventListener(c.search.clear_searches,this.clearPreviousSearches),this.inputTarget.value&&this.resizeInput(),this.setPreviousSearches(),this.inputTarget.addEventListener("click",this.handleInputClick),this.flagLoaded(),this.trackSitelinksSearch(),v&&this.trackSearchSimilarImageComplete())}disconnect(){document.removeEventListener("click",this.blurInlineFilters),this.hasInputTarget&&(this.inputTarget.removeEventListener("blur",this.resizeInput),this.inputTarget.removeEventListener("keyup",this.resizeInput),this.inputTarget.removeEventListener("keydown",this.resizeInput),this.inputTarget.removeEventListener("click",this.removeAutoFocus),this.inputTarget.removeEventListener("keydown",this.removeAutoFocus),this.inputTarget.removeEventListener("click",this.handleInputClick)),window.removeEventListener(c.search.clear_searches,this.clearPreviousSearches),window.removeEventListener("updateEzSearchFormColorSwatch",this.updateSearchSwatch)}setupInlineFilters(){this.setLandingPageInlineFilterDefaults(),document.addEventListener("click",this.blurInlineFilters)}get hiddenInputWidth(){return Math.ceil(this.hiddenInputHolderTarget.getBoundingClientRect().width)}autoFocusSearchForm(){if(this.hasInputTarget){const e=this.inputTarget.value;requestAnimationFrame(()=>{this.inputTarget.value="",this.inputTarget.focus(),this.element.classList.add("is-auto-focused"),this.inputTarget.value=e})}}setLandingPageInlineFilterDefaults(){document.body.classList.contains("resource-landing")?window.filtersState.resetStateToDefault():this.setTogglesFromState()}clearInput(e){e.preventDefault(),this.inputTarget.value="",this.inputTarget.focus(),this.resetAutocomplete(),this.checkAndToggleIsTyped()}setPreviousSearches(){const e=JSON.parse(this.previousSearchTermsTarget.dataset.recentSearches);if(e.length>0){this.addPreviousSearchElements(e,!1);return}const t=window.localStorage.getItem("previous_searches");if(t){const i=JSON.parse(t);this.addPreviousSearchElements(i,!0);return}this.previousSearchesTarget.classList.add("is-hidden")}addPreviousSearchElements(e,t){for(let i=0;i<e.length;i+=1){const s=t?JSON.parse(e[i]):e[i],r=`
        <li class="ez-btn ez-btn--light ez-btn--small" data-action="click->search-form#handleSuggestionClick"
            data-content-type="${s.contentType}">${s.term}</li>`;requestAnimationFrame(()=>{this.previousSearchTermsTarget.insertAdjacentHTML("beforeend",r)})}}handlePreviousClickBlur(e){e.preventDefault()}trackContentTypeSelection(e){const t=e.dataset.trackingAction==="content-type-tab"?R:q;l({element:e,data:{action:t,label:e.value||e.dataset.value,category:document.body.dataset.conversionsCategory}})}updateContentType(e,t){this.inputTarget.setAttribute("data-content-type",e),this.inputTarget.setAttribute("data-autocomplete-content-type",t),u(c.search.update_content_type,{contentType:e})}trackPopularSearchClick(e){const t=this.inputTarget.getAttribute("data-content-type"),i=e.target.getAttribute("data-english-label");l({element:e.target,data:{action:x,label:`Link-${i}`,content_type:`Content-${t}`}})}checkAndToggleIsTyped(){this.searchInputContents?requestAnimationFrame(()=>{this.element.classList.add("is-typed")}):requestAnimationFrame(()=>{this.element.classList.remove("is-typed")})}renderAutocomplete(e,t){if(requestAnimationFrame(()=>{this.formTarget.classList.add("is-suggesting")}),this.autocompleteSuggestionsTarget.innerHTML="",e.length===0){this.resetAutocomplete();return}T.set("last_search_autocomplete_results",JSON.stringify(e),{expires:1}),Object.keys(e).forEach(i=>{const s=document.createElement("LI"),r=e[i].toLowerCase().indexOf(t.toLowerCase());r>=0?requestAnimationFrame(()=>{const a=e[i].substr(r,t.length);s.innerHTML=e[i].replace(new RegExp(t,"ig"),`<strong>${a}</strong>`)}):requestAnimationFrame(()=>{s.innerHTML=e[i]}),s.dataset.action="mousedown->search-form#handleSuggestionClick",requestAnimationFrame(()=>{this.autocompleteSuggestionsTarget.appendChild(s)})})}isMobile(){return document.body.classList.contains("is-mobile")}resetPagination(){const e=window.filtersState.getRawStateObject();Object.prototype.hasOwnProperty.call(e,"page")&&window.filtersState.updateStateValue("page",1)}submitViaButton(e){e.preventDefault(),this.submit(e),this.inputTarget.value.length&&window.requestAnimationFrame(()=>{this.submitTarget.classList.add("is-loading")})}submit(e,{preserveFilters:t=!1}={}){if(this.inputTarget.value.length===0||this.element.hasAttribute("data-disable-form-submit"))return;this.resetPagination(),t||window.filtersState.newSearchDefaultParams.forEach(s=>{window.filtersState.resetKeyToDefault(s)});const i={term:this.inputTarget.value,searchRoute:this.inputTarget.getAttribute("data-search-route"),useSearchState:!0,contentType:this.inputTarget.getAttribute("data-content-type"),searchInNewTab:!1};e.metaKey&&e.code&&e.code==="Enter"&&(i.searchInNewTab=!0),T.set("ezSearchType","internal"),u("Searched",i),this.savePreviousSearch(i),this.trackSearchComplete(),this.inputTarget.value===this.data.get("lastActiveAutocompleteTerm")&&this.trackAutoSuggestSearch(e)}savePreviousSearch(e){let t=JSON.parse(window.localStorage.getItem("previous_searches"));t||(t=[]);for(let i=0;i<t.length;i+=1)if(JSON.parse(t[i]).term===e.term){t.splice(i,1);break}t.unshift(JSON.stringify(e))>6&&t.pop(),window.localStorage.setItem("previous_searches",JSON.stringify(t))}trackManualSearchClick(e){this.element.hasAttribute("data-disable-form-submit")||l({element:e.target,data:{action:H,label:`Terms-${this.inputTarget.value}`,content_type:`Content-${h()}`}})}trackAutoSuggestSearch(e){l({element:e.target,data:{action:$,label:`Terms-${this.inputTarget.value}`,content_type:`Content-${h()}`}}),A.post(`${this.autocompleteUrl()}?original_term=${this.data.get("lastTerm")}&selected_term=${this.data.get("lastActiveAutocompleteTerm")}&content_type=${h()}`)}trackSearchComplete(e=""){const t=[".search-results__meta__results-info",".search-results__header--no-results"];y({action:z,label:`${e}Terms-${this.inputTarget.value}`,valueElementSelector:t,valueAttribute:"search-results-count",dimensions:{content_type:`Content-${h()}`}})}trackSitelinksSearch(){if(!this.element.parentNode.parentElement.classList.contains("ez-site-header")){const e=this.fromSitelinks;e==="sitelinks "&&this.trackSearchComplete(e)}}trackSearchSimilarImageComplete(){new URLSearchParams(window.location.search).get("similar_image_search")==="true"&&y({action:M,dimensions:{content_type:"Content-image"}})}get resultsCount(){const e=document.querySelector("[data-search-results-count]");return e?e.getAttribute("data-search-results-count"):null}get pageNumber(){const e=k();return e||"1"}get searchInputContents(){return this.inputTarget.value}get fromSitelinks(){const t=new URLSearchParams(window.location.search).get("referral");return!t||t!=="sitelinks_searchbox"?"":"sitelinks "}};p.targets=["form","input","submit","clearButton","currentLabel","popularSearches","popularSearchesLink","inlineFilters","previousSearches","hiddenInputHolder","previousSearchTerms","autocompleteSuggestions"],p.values={preserveFilters:Boolean};let m=p;w({name:"search-form",import:m});export{m as default};

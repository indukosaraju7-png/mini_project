import{a as n}from"./stimulus-helpers-Bg5ApOVk-1.js";import o from"./ez-base-controller-DuL8VR07-1.js";import{f as u,E as h,L as p,M as c,F as m}from"./helpers-DWGVlOV6-1.js";import{sendTrackingEvent as l}from"./tracking-ChOFcS2D-1.js";import{b2 as g}from"./actions-C6z5I147-1.js";import{a as s}from"./js-Cz0CWeBA-1.js";import{E as f}from"./ez-popunder-CPI-tcnF-1.js";import"./stimulus-Cq41p_up-1.js";import"./init-user-CLXATX98-1.js";const i="indirect_partner_pu",t=class t extends o{constructor(){super(...arguments),this.openPopup=e=>{s.set(i,"1",{expires:.5/24}),new f().open(e)},this.seenRecently=()=>s.get(i)}maybePagination(e){if(this.mode="pagination",!this.shouldShowPopup())return;const r=this.getNavigationPage(e.target);this.hasSearchValues&&l({data:{action:g,label:`Terms-${this.termsValue}`,value:r,partner_popup_origin:this.sourceValue}}),this.openPopup(this.partnerUrl())}getNavigationPage(e){if(!e||!this.hasCurrentPageTarget)return this.pageValue;if(e===this.currentPageTarget){const r=parseInt(u(this.currentPageTarget),10);return r>this.totalPagesValue?this.totalPagesValue:r}return this.pageValue}maybeSearch(e=null){h()||!this.shouldShowPopup()||this.isLucky()&&(this.searchForm=(e==null?void 0:e.currentTarget)||null,this.mode="search",this.openPopup(this.partnerUrl()))}shouldShowPopup(){var e;return p()||!((e=window.partnerService)!=null&&e.showIndirect())?!1:!this.seenRecently()}isLucky(){return this.randomNumber()===3}randomNumber(){return Math.floor(Math.random()*5)+1}get searchTerm(){const e=this.searchForm||document.querySelector("[data-controller~='search-form']");if(!e)return null;if(this.mode==="pagination")return e.getAttribute("data-search-term").replace(/-/g," ");const r=e.querySelector('input[name="search"]')||e.querySelector('input[name="search_fullwidth"]');return r?r.value:null}partnerUrl(){return window.partnerService.indirectUrl({placement:this.partnerPlacement(),searchTerm:this.searchTerm})}partnerPlacement(){if(this.mode==="pagination")return"pagination";const{classList:e}=document.body;return e.contains("home-home_vectors")?"SearchPopHome":c()?"SearchPopShow":m()?"SearchPopSearch":"SearchPopOther"}get hasSearchValues(){return this.hasTermsValue&&this.hasPageValue&&this.hasSourceValue}};t.targets=["currentPage"],t.values={terms:String,page:Number,totalPages:Number,source:String};let a=t;n({name:"partner-popup",import:a});export{a as default};

import{a as g}from"./stimulus-helpers-Bg5ApOVk-1.js";import h from"./ez-base-controller-DuL8VR07-1.js";import{c as f}from"./ajax-helpers-BQLKOG2a-1.js";import{a as p}from"./js-Cz0CWeBA-1.js";import{sendTrackingEvent as o}from"./tracking-ChOFcS2D-1.js";import{aw as u,ax as k}from"./actions-C6z5I147-1.js";import"./stimulus-Cq41p_up-1.js";import"./index-C4xxlH8f-1.js";import"./_commonjsHelpers-BosuxZz1-1.js";import"./modal_helpers-SODIeXFK-1.js";import"./helpers-DWGVlOV6-1.js";import"./init-user-CLXATX98-1.js";const s=class s extends h{connect(){this.contentRequested=!1,this.seenCookieUpdated=!1,this.activeIds=JSON.parse(this.unseenBadgeTarget.dataset.activeNotifications),this.seenIds=JSON.parse(this.unseenBadgeTarget.dataset.seenNotifications),this.flagLoaded()}getMarketingNotifications(){this.contentRequested||(this.contentRequested=!0,f("/api/v2/marketing_notifications",t=>{this.setNotifications(t.data.marketing_notifications)},t=>{console.error(t)}))}setNotifications(t){if(this.spinnerTarget.classList.add("is-hidden"),t.length===0){this.noNotifications();return}t.forEach((e,i)=>{const a=this.marketingTemplate(e,i+1);requestAnimationFrame(()=>{this.listTarget.insertAdjacentHTML("beforeend",a)})})}noNotifications(){const t=`
      <li class="notification-item no-notifications">
        <h3>Currently no notifications</h3>
        <p>Please check back later</p>
      </li>
    `;requestAnimationFrame(()=>{this.listTarget.insertAdjacentHTML("beforeend",t)})}menuClick(t){t.currentTarget.parentNode.classList.contains("is-closed")&&(this.getMarketingNotifications(),this.seenCookieUpdated||(this.seenCookieUpdated=!0,this.updateSeenCookie()),this.sendOpenClick(t,this.activeIds.length))}updateSeenCookie(){const t=this.seenIds;if(this.activeIds){this.activeIds.forEach(i=>{t.includes(i)||t.push(i)});let e=0;for(;e<t.length&&!(t.length<=100);)this.activeIds.indexOf(t[e])===-1&&(t.splice(e,1),e-=1),e+=1;p.set("seen_notifications",JSON.stringify(t)),this.setSeenBadge()}}sendOpenClick(t,e){o({element:t.currentTarget,data:{action:u,category:"Header",value:e}})}sendCompleteEvent(t){o({element:t.currentTarget,data:{action:k,category:"Header",label:t.currentTarget.dataset.trackingLabel,value:parseInt(t.currentTarget.dataset.position,10)}})}marketingTemplate(t,e){const{id:i,title:a,url:r,new_tab:c,image:d,button_text:l}=t,m=`
      href="${r}"
      data-action="click->notifications-menu#sendCompleteEvent"
      data-tracking-label="${a}"
      data-position="${e}"
      ${c?'target="_blank"':""}
    `;return`
      <li class="notification-item marketing-notification" data-id="${i}">
        <a ${m}>
          <img src="${d.large.url}" onerror="this.remove();" />
          <h6 class="marketing-notification__title">${a}</h6>
          <button class="ez-btn ez-btn--medium marketing-notification__btn">${l}</button>
        </a>
      </li>
    `}setSeenBadge(){requestAnimationFrame(()=>{this.unseenBadgeTarget.innerHTML="",this.unseenBadgeTarget.classList.add("is-hidden")})}};s.targets=["menuButton","list","unseenBadge","spinner"];let n=s;g({name:"notifications-menu",import:n});export{n as default};

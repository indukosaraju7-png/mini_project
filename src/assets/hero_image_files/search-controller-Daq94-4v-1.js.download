import{a as l}from"./stimulus-helpers-Bg5ApOVk-1.js";import{a as c}from"./js-Cz0CWeBA-1.js";import d from"./ez-base-controller-DuL8VR07-1.js";import{e as i}from"./events-BkNvg-Hc-1.js";import{t as n,f as u}from"./helpers-DWGVlOV6-1.js";import{F as p}from"./filters-state-BjbyzNKW-1.js";import{i as m}from"./search-helpers-Cl-DCMsp-1.js";import"./stimulus-Cq41p_up-1.js";import"./init-user-CLXATX98-1.js";class g extends d{constructor(){super(...arguments),this.applySearchFilters=e=>{this.resetContentType(e),c.set("ezSearchType","internal");const t=window.filtersState.getFlatQueryString(),r=this.unverifiedPath||this.changingContentType()?this.getNewSearchUrl(this.searchRoute,this.searchTerm,t):`${window.location.pathname}${t}`;this.turboVisit(r)},this.postAjaxEvent=e=>{this.postAjax(e.detail.dataHash)},this.searchPaginationEvent=e=>{n("PaginationChanged",{page:e.detail.page,stateKey:"search-state",extraStates:["filterState"],ajaxEventName:"PostSearchAjax",resultsTarget:document.querySelector(".search-results")})},this.performSearch=e=>{const{searchPath:t}=e.detail,r=e.detail.searchRoute?e.detail.searchRoute:this.searchRoute,o=this.normalizeTerm(e.detail.term);this.resetContentType(e);const s=e.detail.useSearchState?window.filtersState.getFlatQueryString().substring(1):null,a=t||this.getNewSearchUrl(r,o,s);m(),e.detail.searchInNewTab===!0?window.open(a,"_blank"):this.turboVisit(a)},this.enforceFilterDefault=e=>{const t=document.querySelector(`[data-collapse-key="${e}"]`);if(t){const r=t.dataset.overrideDefaultValue;r&&window.filtersState.updateParamKey(`${e}-${r}`)}},this.resetContentType=e=>{if(this.contentType=e.detail.contentType||this.contentType,e.detail.contentType&&c.set("content_type",e.detail.contentType),this.changingContentType()&&!e.detail.preserveFilters){const t=this.element.dataset.searchAiFilterDefault;window.filtersState.resetStateToDefault(),t&&window.filtersState.updateParamKey(`is_ai_generated-${t}`)}},this.postAjax=e=>{window.filtersState.updateStateValue("page",e.page);const t=window.filtersState.getFlatQueryString(),r=this.unverifiedPath||this.changingContentType()?this.getNewSearchUrl(this.searchRoute,this.searchTerm,t):`${window.location.pathname}${t}`;this.searchType&&c.set("ezSearchType",this.searchType),window.location.assign(r)},this.trackSearchClick=e=>{const t=e.target.closest(".search-results .ez-search-results .ez-resource-grid__item");t&&n(i.search.click,{resourceId:t.getAttribute("data-item-id"),resourcePosition:t.getAttribute("data-position"),resourcePro:t.getAttribute("data-pro"),searchTerm:this.searchTerm})},this.trackSponsoredSearchClick=e=>{const t=e.target.closest(".search-results .eezy-sponsored-results .ez-resource-grid__item");t&&n(i.search.sponsored_click,{resourceId:t.getAttribute("data-item-id"),resourcePosition:t.getAttribute("data-position"),resourcePro:"",searchTerm:this.searchTerm,sponsored:!0})}}connect(){var e;window.filtersState=(e=window.filtersState)!=null&&e.isSearchState()?window.filtersState:new p,this.searchFormInput=document.querySelector('[data-search-form-target="input"]'),this.searchFormInput&&(this.contentType=this.searchFormInput.getAttribute("data-content-type"),window.location.href.indexOf("/free-png/")>-1&&(this.contentType="png")),window.addEventListener("PostSearchAjax",this.postAjaxEvent),window.addEventListener("SearchPaginationChange",this.searchPaginationEvent),window.addEventListener("Searched",this.performSearch),window.addEventListener("click",this.trackSearchClick),window.addEventListener("click",this.trackSponsoredSearchClick),window.addEventListener(i.search.apply_filters,this.applySearchFilters),window.addEventListener(i.search.update_content_type,this.resetContentType)}disconnect(){window.removeEventListener("PostSearchAjax",this.postAjaxEvent),window.removeEventListener("SearchPaginationChange",this.searchPaginationEvent),window.removeEventListener("Searched",this.performSearch),window.removeEventListener("click",this.trackSearchClick),window.removeEventListener("click",this.trackSponsoredSearchClick),window.removeEventListener(i.search.apply_filters,this.applySearchFilters),window.removeEventListener(i.search.update_content_type,this.resetContentType)}changingContentType(){return this.contentType!==this.searchFormInput.getAttribute("data-content-type")}getNewSearchUrl(e,t,r){const o=t.match(/url:.*/)||t.match(/id:.*/);if(window.location.pathname.includes("search_by_image")&&o)return`${window.location.pathname}${r}`;const s=e,a=[];return e===this.searchRoute&&a.push(`qterm=${t}`,`content_type=${this.contentType}`),r&&r.replace(/^\?/,"").split("&").forEach(h=>{a.push(h)}),a.length>0?`/${s}?${a.join("&")}`:s}turboVisit(e){var t;if((t=window.Turbo)!=null&&t.visit){window.Turbo.visit(e);return}window.location.assign(e)}footerPagerChange(e){e.preventDefault();const t=document.querySelector('[data-pagination-target="currentPage"]'),r=u(t)+1;n("SearchPaginationChange",{page:r})}normalizeTerm(e){return encodeURIComponent(e.toLowerCase().trim().replace(/ /g,"-"))}get searchRoute(){return this.searchFormInput?this.searchFormInput.getAttribute("data-search-route"):"search"}get searchTerm(){const e=this.element.querySelector("[data-search-term]");return e?e.getAttribute("data-search-term"):""}get searchType(){const e=this.element.querySelector("[data-search-type]");return e?e.getAttribute("data-search-type"):null}get unverifiedPath(){return window.location.pathname===`/${this.searchRoute}`}}l({name:"search",import:g});export{g as default};
